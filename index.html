<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Chat Salesforce Custom Button</title>
<style>
  /* Stile del pulsante custom */
  #customChatButton {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #0070d2;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    z-index: 9999;
  }

  #customChatButton:hover {
    background-color: #005fb2;
  }
</style>
</head>
<body>

<!-- Pulsante personalizzato -->
<button id="customChatButton">Serve aiuto?</button>

<script type='text/javascript'>
// Funzione di inizializzazione Embedded Messaging
function initEmbeddedMessaging() {
    try {
        // Nascondi il pulsante standard (se presente)
        embeddedservice_bootstrap.settings.displayHelpButton = false;

        embeddedservice_bootstrap.settings.language = 'it';

        embeddedservice_bootstrap.init(
            '00DKB0000014aXF',
            'Web_test',
            'https://pianidibobbio.my.site.com/ESWWebtest1763410614711',
            {
                scrt2URL: 'https://pianidibobbio.my.salesforce-scrt.com'
            }
        );

        // Gestione chiusura chat per far ricomparire il pulsante
        embeddedservice_bootstrap.addEventHandler('onChatEnded', function() {
            document.getElementById('customChatButton').style.display = 'block';
        });

    } catch (err) {
        console.error('Error loading Embedded Messaging: ', err);
    }
}

// Carica lo script bootstrap di Salesforce
(function() {
    var s = document.createElement('script');
    s.src = 'https://pianidibobbio.my.site.com/ESWWebtest1763410614711/assets/js/bootstrap.min.js';
    s.onload = initEmbeddedMessaging;
    s.type = 'text/javascript';
    document.head.appendChild(s);
})();

// Gestione click sul pulsante custom
document.getElementById('customChatButton').addEventListener('click', function() {
    // Nascondi il pulsante
    this.style.display = 'none';
    // Avvia la chat
    if (window.embeddedservice_bootstrap) {
        embeddedservice_bootstrap.startChat();
    } else {
        console.error('Embedded Messaging non inizializzato.');
    }
});
</script>

</body>
</html>

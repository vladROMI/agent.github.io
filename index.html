<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Preview Agentforce</title>
    <link rel="icon" href="data:,">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            text-align: center;
        }
        .logo {
            max-width: 250px;
            height: auto;
            margin-bottom: 20px;
        }
        .title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        .language-selector {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
        }
        .lang-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #0070d2;
            background-color: white;
            color: #0070d2;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .lang-btn:hover {
            background-color: #0070d2;
            color: white;
        }
        .lang-btn.active {
            background-color: #0070d2;
            color: white;
        }
        
        /* Personalizzazione del launcher button */
        .embeddedMessagingConversationButton {
            background-color: #0070d2 !important;
        }
        
        .embeddedMessagingConversationButton .message {
            color: #ffffff !important;
        }
    </style>
</head>
<body>
    <!-- Logo -->
    <img src="bobbio_logo.png" alt="Logo Azienda" class="logo">
    
    <!-- Testo -->
    <div class="title">TEST Agentforce</div>
    
    <!-- Selettore Lingua -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="changeLanguage('it')" id="btn-it">ðŸ‡®ðŸ‡¹ Italiano</button>
        <button class="lang-btn" onclick="changeLanguage('en')" id="btn-en">ðŸ‡¬ðŸ‡§ English</button>
    </div>
 
    <script type="text/javascript">
        let currentLanguage = 'it';
        let isInitialized = false;

        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // Aggiorna lo stile dei bottoni
            document.getElementById('btn-it').classList.toggle('active', lang === 'it');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            
            // Aggiorna il testo del launcher
            updateLauncherText(lang);
        }
        
        function updateLauncherText(lang) {
            const labelText = lang === 'en' ? 'Need help?' : 'Serve aiuto?';
            
            // Cerca il launcher button e aggiorna il testo
            const checkLauncher = setInterval(() => {
                const launcherButton = document.querySelector('.embeddedMessagingConversationButton');
                if (launcherButton) {
                    const messageElement = launcherButton.querySelector('.message');
                    if (messageElement) {
                        messageElement.textContent = labelText;
                        console.log('Launcher aggiornato:', labelText);
                    }
                }
            }, 100);
            
            // Stop dopo 5 secondi
            setTimeout(() => clearInterval(checkLauncher), 5000);
        }

        function initEmbeddedMessaging() {
            try {
                // Rileva la lingua dal path
                const path = window.location.pathname;
                let language = 'it';
                
                if (path.includes('/en/')) {
                    language = 'en';
                    currentLanguage = 'en';
                    document.getElementById('btn-it').classList.remove('active');
                    document.getElementById('btn-en').classList.add('active');
                }
                
                console.log('Inizializzazione con lingua:', language);
                
                // Imposta la lingua
                embeddedservice_bootstrap.settings.language = language;
                
                // Inizializza il widget
                embeddedservice_bootstrap.init(
                    "00DKB0000014aXF",                
                    "Web",                             
                    "https://pianidibobbio.my.site.com/ESWWebtest1763410614711", 
                    {
                        scrt2URL: "https://pianidibobbio.my.salesforce-scrt.com"
                    }
                );
                
                isInitialized = true;
                
                // Attendi che il launcher sia renderizzato e poi personalizzalo
                setTimeout(() => {
                    updateLauncherText(language);
                    
                    // Personalizza l'icona se necessario
                    const launcherIcon = document.querySelector('.embeddedMessagingConversationButton .icon');
                    if (launcherIcon) {
                        launcherIcon.style.backgroundImage = 'url(https://pianidibobbio.file.force.com/sfc/dist/version/renditionDownload?rendition=ORIGINAL_Jpg&versionId=068KB000006Bg5z&operationContext=DELIVERY&contentId=05TKB00000cW6Zd&page=0&d=/a/KB000000oQmX/rf61g94muITSDNRmmLNR7mVLk8Bq0k3Y1gXLZ_jPoAY&oid=00DKB0000014aXF&dpt=null&viewId=)';
                        launcherIcon.style.backgroundSize = 'cover';
                        launcherIcon.style.width = '48px';
                        launcherIcon.style.height = '48px';
                    }
                }, 2000);
                
            } catch (err) {
                console.error("Errore Embedded Service Web v2:", err);
            }
        }
    </script>
    
    <script 
        type="text/javascript" 
        src="https://pianidibobbio.my.site.com/ESWWebtest1763410614711/assets/js/bootstrap.min.js" 
        onload="initEmbeddedMessaging()">
    </script>
</body>
</html>
